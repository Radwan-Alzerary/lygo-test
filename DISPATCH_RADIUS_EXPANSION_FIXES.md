# ุฅุตูุงุญุงุช ูุธุงู Dispatch - ููุน ููุฏุงู ุงูุฑุญูุงุช ุนูุฏ ุชูุณูุน ุงููุทุงู

## ุงููุดููุฉ ุงููุญุฏุฏุฉ:

ูุงู ุงููุงุจุชู ูุณุชูู ุฑุณุงูุฉ `hideRide` ูุน ุงูุณุจุจ `"timeout_radius_5km"` ููุง ูุฑู ุงูุฑุญูุฉ ูุฑุฉ ุฃุฎุฑูุ ุฑุบู ุฃูู ูุชูุฑุบ ููู ููุบ ุงูุฑุญูุฉ. ูุฐุง ูุญุฏุซ ูุฃู ุงููุธุงู ูุงู ูุฎูู ุงูุฑุญูุฉ ูู ุงููุงุจุชูุฒ ูู ุงููุทุงู ุงูุณุงุจู ุนูุฏูุง ูุชูุณุน ุงููุทุงู ููุจุญุซ ุนู ูุงุจุชูุฒ ุฌุฏุฏ.

## ุงูุญู ุงููุทุจู:

### 1. ุฅูุบุงุก ุฅุฎูุงุก ุงูุฑุญูุฉ ุฃุซูุงุก ุชูุณูุน ุงููุทุงู
**ุงูุชุบููุฑ:**
- ุฃูุบููุง ุงุณุชุฏุนุงุก `notifyCurrentRadiusCaptainsToHide()` ุฃุซูุงุก ุชูุณูุน ุงููุทุงู
- ุงููุงุจุชูุฒ ุงูุณุงุจููู ูุญุชูุธูู ุจุงูุฑุญูุฉ ููุง ุชูุฎูู ูููู

**ุงูููุฏ ุงููุญุฏุซ:**
```javascript
// ุจุฏูุงู ูู ุฅุฎูุงุก ุงูุฑุญูุฉ:
// this.notifyCurrentRadiusCaptainsToHide(rideId, `timeout_radius_${...}km`);

// ูุญู ูุณุฌู ููุท:
this.logger.info(`[Dispatch] ๐ Ride ${rideId}: No acceptance in radius. Previous captains remain available while expanding search.`);
```

### 2. ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑุญูุฉ ูููุงุจุชูุฒ ุงููุชูุฑุบูู
**ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ:**
- ุงููุธุงู ูุชุญูู ูู ุงููุงุจุชูุฒ ุงูุฐูู ุชู ุฅุดุนุงุฑูู ุณุงุจูุงู
- ุฅุฐุง ูุงููุง ูุชูุฑุบูู ุงูุขู (ูุง ููุฌุฏ ูุฏููู pending rides)ุ ููุนุงุฏ ุฅุฑุณุงู ุงูุฑุญูุฉ ููู

**ุงูููุฏ ุงูุฌุฏูุฏ:**
```javascript
// Get previously notified captains in this radius who might be available again
const previouslyNotifiedInRadius = nearbyCaptainIds.filter(captainId =>
  this.onlineCaptains[captainId] && 
  globalNotifiedCaptains.has(captainId) &&
  !this.hasPendingRide(captainId) // They don't have pending rides, so they're available
);

// Re-send to available previous captains
const reNotifications = await this.resendToAvailableCaptains(rideId, previouslyNotifiedInRadius, rideData);
```

### 3. ุฏุงูุฉ ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุงูุฐููุฉ
**ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ: `resendToAvailableCaptains`**
- ุชุชุญูู ูู ุชููุฑ ุงููุงุจุชู
- ุชูุฑุณู ุงูุฅุดุนุงุฑ ูุน ุนูุงูุฉ `isReSend: true`
- ุชุณุฌู ุงูุฅุญุตุงุฆูุงุช ุจุดูู ูููุตู

### 4. ุฑุณุงุฆู ุฃูุถุญ ูููุงุจุชูุฒ
**ุงูุชุญุณูู:**
- ุฅุฐุง ุชู ุฅุฑุณุงู hideRide ุฃุซูุงุก ุชูุณูุน ุงููุทุงูุ ุงูุฑุณุงูุฉ ุชููู:
  `"Expanding search area - you may receive this ride again"`
- ุจุฏูุงู ูู ุงูุฑุณุงูุฉ ุงููุฑุจูุฉ: `"Searching for captains in a wider area"`

### 5. ุชุญุฏูุซ Logging
**ุงูุฅุญุตุงุฆูุงุช ุงูุฌุฏูุฏุฉ:**
```
[Dispatch] ๐ฅ Ride ${rideId}: Found ${newOnlineCaptains.length} new + ${previouslyNotifiedInRadius.length} available previous captains
[Dispatch] ๐ค Ride ${rideId}: Processed ${totalSent} immediate (${newNotifications.sent} new + ${reNotifications.sent} re-sent) + ${totalQueued} queued notifications
[Dispatch] ๐ Re-sent ride ${rideId} to available captain ${captainId}
```

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ:

### โ **ูุจู ุงูุฅุตูุงุญ:**
1. ูุงุจุชู ูู ูุทุงู 2km ูุณุชูู ุงูุฑุญูุฉ
2. ูุง ูุฑุฏ ุฎูุงู 15 ุซุงููุฉ
3. ุงููุธุงู ูุชูุณุน ูููุทุงู 3km
4. ุงููุงุจุชู ูุณุชูู `hideRide` ูุน `timeout_radius_3km`
5. **ูุง ูุฑู ุงูุฑุญูุฉ ูุฑุฉ ุฃุฎุฑู** โ

### โ **ุจุนุฏ ุงูุฅุตูุงุญ:**
1. ูุงุจุชู ูู ูุทุงู 2km ูุณุชูู ุงูุฑุญูุฉ
2. ูุง ูุฑุฏ ุฎูุงู 15 ุซุงููุฉ
3. ุงููุธุงู ูุชูุณุน ูููุทุงู 3km
4. **ุงููุงุจุชู ูุง ูุณุชูู hideRide** โ
5. ุฅุฐุง ูู ูููุฌุฏ ูุงุจุชู ูู ุงููุทุงู ุงูุฌุฏูุฏุ **ููุนุงุฏ ุฅุฑุณุงู ุงูุฑุญูุฉ ูููุงุจุชู ุงูุฃูู** โ
6. ุงููุงุจุชู ูุฑู ุงูุฑุญูุฉ ูุฑุฉ ุฃุฎุฑู ูููููู ูุจูููุง โ

## ุงูุชูุงูู ูุงูุณูุงูุฉ:

- โ **ูุง ูุคุซุฑ ุนูู ุงููุธุงุฆู ุงูุฃุฎุฑู**
- โ **ูุญุณู ุชุฌุฑุจุฉ ุงููุงุจุชู**
- โ **ูุฒูุฏ ูุนุฏู ูุฌุงุญ ุงูุฑุญูุงุช**
- โ **ูุชูุงูู ูุน ูุธุงู Queue ุงูุญุงูู**
- โ **ูุญุงูุธ ุนูู ุงูุฅุญุตุงุฆูุงุช ูุงูุชุชุจุน**

## ุฃุฏุงุก ุงููุธุงู:

**ุงููุฒุงูุฏ:**
- ุนุฏุฏ ุฃูู ูู ุฑุณุงุฆู hideRide ุบูุฑ ุงูุถุฑูุฑูุฉ
- ููุงุกุฉ ุฃุนูู ูู ุงูุนุซูุฑ ุนูู ูุงุจุชู
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู

**ูุง ููุฌุฏ ุขุซุงุฑ ุฌุงูุจูุฉ ุณูุจูุฉ:**
- ููุณ ุงุณุชููุงู ุงูุฐุงูุฑุฉ
- ููุณ ุงุณุชููุงู ุงูุดุจูุฉ ุชูุฑูุจุงู
- ุชุญุณู ูู ูุนุฏู ูุฌุงุญ ุงูุฑุญูุงุช

## ุงูุฎูุงุตุฉ:

ูุฐุง ุงูุฅุตูุงุญ ูุญู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ ููุถูู ุฃู ุงููุงุจุชูุฒ ุงููุชูุฑุบูู ูุง ูููุฏูู ุงูุฑุญูุงุช ุฃุซูุงุก ุชูุณูุน ูุทุงู ุงูุจุญุซ. ุงููุธุงู ุฃุตุจุญ ุฃูุซุฑ ุฐูุงุกู ูููุงุกุฉ ูู ุชูุฒูุน ุงูุฑุญูุงุช.
